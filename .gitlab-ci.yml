stages:
  - build
  - coverage

job 1:
  stage: build
  script:
  - scons -Q
  - scons -c 
  - scan-build-3.9 --status-bugs scons --analyze

job 2:
  stage: coverage
  script:
  - export DISPLAY=:0
  - export CI_NAME=bamboo
  - export CI_BUILD_NUMBER=$CI_JOB_ID
  - export CI_BUILD_URL=$CI_JOB_URL
  - export CI_BRANCH=$CI_COMMIT_REF_NAME
  - export COVERALLS_REPO_TOKEN=d9sYRjnXQnFv13ooFbqalP5ZWf8QxVrWe
  - export CI=true
  - xhost +local:all
  - scons --unit --test --debug_build --coverage
  - coveralls --exclude Testing --exclude Dependencies --exclude build --gcov-options '\-lp'
  